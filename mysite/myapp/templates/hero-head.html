<section id="head_app">
<div class="hero-head">
    <header class="navbar is-transparent">
        <div class="container">
            <div class="navbar-brand ">
                <a class="navbar-item " href="/">
                    <img src="/static/images/Logo.png" alt="Noobtronics Logo" class="HeroLogo">
                </a>
                <span class="navbar-burger burger" data-target="navbarMenuHeroC" v-on:click="show_mob_nav=!show_mob_nav">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
                <div class="navbar-item has-dropdown is-hoverable is-invisible-desktop" >
                    <div class="dropdown-trigger">
                        <a :data-balloon="cartqty==0 ? 'Your cart is Empty!': false " data-balloon-pos="down" id='cartnav1' class="button is-success is-inverted" v-on:click='handle_cart_click()' v-bind:class="{'badge is-badge-danger': cartqty > 0}" v-bind:data-badge="cartqty" >
                                    <span class="icon">
                                      <i class="fas fa-shopping-cart"></i>
                                    </span>
                        </a>
                    </div>
                </div>
            </div>
            <div id="navbarMenuHeroC" class="navbar-menu" v-bind:class="{'is-active':show_mob_nav}">
                <div class="navbar-end">
                    <nav class="level">
                        <a class="navbar-item is-active" href="/">
                            Home
                        </a>
                        <a class="navbar-item" href="/shop">
                            Shop
                        </a>
                        <a class="navbar-item" v-on:click="openAboutWindow">
                            About Us
                        </a>
                        <a class="navbar-item" v-on:click="openContactUsWindow">
                            Contact
                        </a>
                        {% if not loggedin %}
                        <a class="navbar-item" style="margin-right: 10px;" v-on:click="ModalLogin=true">
                            Login
                        </a>
                        {% else %}
                        <div class="navbar-item has-dropdown is-hoverable">
                            <a class="navbar-link" v-on:click="show_mob_acct=!show_mob_acct">
                                My Account
                            </a>
                            <div class="navbar-dropdown is-boxed myaccount" v-bind:class="{'is-invisible-mobile': !show_mob_acct}">
                                <a class="navbar-item" href="/orders">
                                    Orders
                                </a>
                                <a class="navbar-item" v-on:click="processLogout()">
                                    Logout
                                </a>
                            </div>
                        </div>
                        {% endif %}

                        <div class="mobilecart navbar-item has-dropdown is-hoverable is-invisible-mobile">
                            <div class="dropdown-trigger">
                                <a :data-balloon="cartqty==0 ? 'Your cart is Empty!': false " data-balloon-pos="down" id='cartnav2' class="button is-success is-inverted" v-on:click='handle_cart_click()' v-bind:class="{'badge is-badge-danger': cartqty > 0}" v-bind:data-badge="cartqty" >
                                    <span class="icon">
                                      <i class="fas fa-shopping-cart"></i>
                                    </span>
                                </a>
                            </div>
                        </div>

                    </nav>
                </div>
            </div>
        </div>
    </header>

</div>


<div class="modal" v-bind:class="{'is-active': ModalLogin}">
    <div class="modal-card loginmodal bShadow-10">
        <section class="modal-card-body">
            Login
            <div class="modalclose">
                    <span v-on:click="ModalLogin=false">
                        <i class="fa fa-window-close" aria-hidden="true"></i>
                    </span>
            </div>
            <div id="GsigninButton"></div>
            <div id="FBsigninButton"></div>
        </section>
    </div>
</div>


    <div class="modal blackmodal" v-bind:class="{'is-active': ModalAbout}">
        <div class="modal-card aboutus-modal bShadow-10">
            <section class="modal-card-body">
                <div class="modalclose">
                    <span v-on:click="ModalAbout=false">
                        <i class="fa fa-window-close" aria-hidden="true"></i>
                    </span>
                </div>
                <div id="headaboutcontent"></div>
            </section>
        </div>
    </div>

    <div class="modal blackmodal" v-bind:class="{'is-active': ModalContactUs}">
        <div class="modal-card bShadow-10">
            <section class="modal-card-body">
                <div class="modalclose">
                    <span v-on:click="ModalContactUs=false">
                        <i class="fa fa-window-close" aria-hidden="true"></i>
                    </span>
                </div>
                <div class="content">
                    <p>
                        <b>Email</b>: info@noobtronics.ltd
                    </p>
                    <p>
                        <b>WhatsApp</b>: <a style="color: blue" href="https://wa.me/919833870385/?text=Hi%20Noobtroncis" target="_blank">+91-9833870385</a>
                    </p>
                </div>
            </section>
        </div>
    </div>


    <div class="modal" v-bind:class="{'is-active': ask_mobile}">
    <div class="modal-card askmobmodal bShadow-10">
        <section class="modal-card-body">
            Contact Information
            <div class="modalclose">
                <!-- <span v-on:click="ModalLogin=false">
                    <i class="fa fa-window-close" aria-hidden="true"></i>
                </span> -->
            </div>

            <div class="" style="margin-top: 20px;" id="askmobdiv">
              <div class="field is-horizontal">
                  <div class="field-body">
                      <div class="field is-expanded">
                          <div class="field has-addons">
                              <p class="control">
                                  <a class="button is-static">
                                      +91
                                  </a>
                              </p>
                              <p class="control is-expanded">
                                  <input class="input" name="mobile" type="tel" placeholder="Your mobile number" v-model="mobileinput" maxlength="10">
                              </p>
                          </div>
                          <p class="help"></p>
                      </div>
                  </div>
              </div>
                <div class="has-text-centered" style="margin-top: 30px;">
                    <a class="button is-link" v-on:click="submit_mobile">Save</a>
                </div>

            </div>
        </section>
    </div>
</div>

    <div class="lds-dual-ring" v-if="loading"></div>
</section>


<script>
    var openAboutWindow = function(){
        if(head_app.downloadAbout){
            head_app.loading = true;
            axios({
                method: 'get',
                url: '/api/aboutuscontent'
            }).then(function(response) {
                var mydata = document.getElementById("headaboutcontent").innerHTML = response.data;
                head_app.downloadAbout = false;
                head_app.loading = false;
                head_app.ModalAbout = true;
            });
        }
        else{
            head_app.ModalAbout = true;
        }
    };
</script>


<script>
    var head_app = new Vue({
        el: '#head_app',
        data: {
            ModalLogin: false,
            loading: false,
            cartqty: cartqty,
            ModalAbout: false,
            downloadAbout: true,
            ModalContactUs: false,
            show_mob_nav: false,
            show_mob_acct: false,
            ask_mobile: ask_mobile,
            mobileinput : ''
        },
        methods: {
            processLogout: function () {
                processLogout();
            },
            handle_cart_click: function(){
                if(this.cartqty > 0){
                    window.location='/cart';
                }
                else{

                }
            },
            openAboutWindow:function(){
                openAboutWindow();
            },
            openContactUsWindow: function(){
                this.ModalContactUs = true;
            },
            submit_mobile: function(){
                submit_mobile();
            }
        }
    })

    var csrfmiddlewaretoken = getCookie('csrftoken');

    var submit_mobile = function(){
      if(head_app.mobileinput.length != 10){
        $("#askmobdiv").find("input").addClass("is-danger");
        $("#askmobdiv").find(".help").html("Enter 10 digit mobile correctly");
        return;
      }
      if(isNaN(head_app.mobileinput)){
        $("#askmobdiv").find("input").addClass("is-danger");
        $("#askmobdiv").find(".help").html("Enter 10 digit mobile correctly");
        return;
      }
      processSaveMobile();
    }

    function onSignIn(googleUser) {
        if(user_authenticated){
            return;
        }
        var auth2 = gapi.auth2.getAuthInstance();
        var profile = auth2.currentUser.get().getBasicProfile();

        var d = {
            id_token: googleUser.getAuthResponse().id_token,
            first_name: profile.getGivenName(),
            last_name: profile.getFamilyName(),
            email: profile.getEmail(),
            uri: location.pathname.substring(1)
        };
        processLogin(d);
    }

    $('#GsigninButton').click(function() {
        var prod_url='https://accounts.google.com/o/oauth2/v2/auth?scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email&access_type=offline&include_granted_scopes=true&redirect_uri=https%3A%2F%2Fnoobtronics.ltd%2Fgooglecallback&response_type=code&client_id=436152518040-289nirmcqqh1dik5409htqhgsrrjr140.apps.googleusercontent.com&prompt=select_account';
        var local_url = 'https://accounts.google.com/o/oauth2/v2/auth?scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile&access_type=offline&include_granted_scopes=true&redirect_uri=http%3A%2F%2Flocalhost%3A8000%2Fgooglecallback&response_type=code&client_id=436152518040-289nirmcqqh1dik5409htqhgsrrjr140.apps.googleusercontent.com&prompt=select_account';

        window.location = prod_url + '&state='+encodeURIComponent(window.location.href);
    });


    $('#FBsigninButton').click(function() {
        var prod_url='https://www.facebook.com/v3.2/dialog/oauth?client_id=330900420888261&scope=email';
        prod_url = prod_url + '&redirect_uri='+encodeURI(window.location.origin+'/fb-login');
        window.location = prod_url;
    });


    var processLogin = function(d){
        head_app.loading = true;
        axios({
            method: 'post',
            url: '/api/login',
            data: d
        }).then(function(response) {
            console.log(response);
            head_app.loading = false;
            if(response.data.success){
                location.reload();
            }
        });
    };

    var processLogout = function(){
        head_app.loading = true;
        axios({
            method: 'post',
            url: '/api/logout'
        }).then(function(response) {
            head_app.loading = false;
            if(response.data.success){
                console.log('logging out...');
                window.location.href = "/";
            }
        });
    };

    var processSaveMobile = function(d){
        head_app.loading = true;
        axios({
            method: 'post',
            url: '/api/savemobile',
            data: {
              'mobile': head_app.mobileinput
            }
        }).then(function(response) {
            console.log(response);
            head_app.loading = false;
            if(response.data.success){
                head_app.ask_mobile = false;
            }
        });
    };
</script>


<script>
    var get_cart_nav_menu = function(){
        var cartnav1 = $('#cartnav1');
        var cartnav2 = $('#cartnav2');
        if($(cartnav1).parent().parent().css("visibility")=='hidden'){
            return cartnav2;
        }
        return cartnav1;
    }
</script>
